!function(e,t){var i='<div id="{{id}}" class="mui-slider mui-preview-image mui-fullscreen"><div class="mui-preview-header">{{header}}</div><div class="mui-slider-group"></div><div class="mui-preview-footer mui-hidden">{{footer}}</div><div class="mui-preview-loading"><span class="mui-spinner mui-spinner-white"></span></div></div>',s='<div class="mui-slider-item mui-zoom-wrapper {{className}}"><div class="mui-zoom-scroller"><img src="{{src}}" data-preview-lazyload="{{lazyload}}" style="{{style}}" class="mui-zoom"></div></div>',n="__DEFAULT",a=document.createElement("div"),r=function(t){this.options=e.extend(!0,{id:"__MUI_PREVIEWIMAGE",zoom:!0,header:'<span class="mui-preview-indicator"></span>',footer:""},t||{}),this.init(),this.initEvent()},o=r.prototype;o.init=function(){var t=this.options,s=document.getElementById(this.options.id);s||(a.innerHTML=i.replace(/\{\{id\}\}/g,this.options.id).replace("{{header}}",t.header).replace("{{footer}}",t.footer),document.body.appendChild(a.firstElementChild),s=document.getElementById(this.options.id)),e.options.gestureConfig.pinch=!0,e.options.gestureConfig.doubletap=!0,this.element=s,this.scroller=this.element.querySelector(e.classSelector(".slider-group")),this.indicator=this.element.querySelector(e.classSelector(".preview-indicator")),this.loader=this.element.querySelector(e.classSelector(".preview-loading")),t.footer&&this.element.querySelector(e.classSelector(".preview-footer")).classList.remove(e.className("hidden")),this.addImages()},o.initEvent=function(){var t=this;e(document.body).on("tap","img[data-preview-src]",function(){return t.isAnimationing()?!1:(t.open(this),!1)});var i=null,s=function(){!i&&(i=e.later(function(){t.isInAnimation=!0,t.loader.removeEventListener("tap",s),t.scroller.removeEventListener("tap",s),t.close()},300))};this.scroller.addEventListener("doubletap",function(){i&&(i.cancel(),i=null)}),this.element.addEventListener("webkitAnimationEnd",function(){t.element.classList.contains(e.className("preview-out"))?(t.element.style.display="none",t.element.classList.remove(e.className("preview-out")),i=null):(t.loader.addEventListener("tap",s),t.scroller.addEventListener("tap",s)),t.isInAnimation=!1}),this.element.addEventListener("slide",function(i){if(t.options.zoom){var s=t.element.querySelector(".mui-zoom-wrapper:nth-child("+(t.lastIndex+1)+")");s&&e(s).zoom().setZoom(1)}var n=i.detail.slideNumber;t.lastIndex=n,t.indicator&&(t.indicator.innerText=n+1+"/"+t.currentGroup.length),t._loadItem(n)})},o.isAnimationing=function(){return this.isInAnimation?!0:(this.isInAnimation=!0,!1)},o.addImages=function(e,t){this.groups={};var i=[];if(i=e?e===n?document.querySelectorAll("img[data-preview-src]:not([data-preview-group])"):document.querySelectorAll("img[data-preview-src][data-preview-group='"+e+"']"):document.querySelectorAll("img[data-preview-src]"),i.length)for(var s=0,a=i.length;a>s;s++)this.addImage(i[s])},o.addImage=function(e){var t=e.getAttribute("data-preview-group");t=t||n,this.groups[t]||(this.groups[t]=[]);var i=e.getAttribute("src");if(e.__mui_img_data&&e.__mui_img_data.src===i)this.groups[t].push(e.__mui_img_data);else{var s=e.getAttribute("data-preview-src");s||(s=i);var a={src:i,lazyload:i===s?"":s,loaded:i===s?!0:!1,sWidth:0,sHeight:0,sTop:0,sLeft:0,sScale:1,el:e};this.groups[t].push(a),e.__mui_img_data=a}},o.empty=function(){this.scroller.innerHTML=""},o._initImgData=function(i,s){if(!i.sWidth){var n=i.el;i.sWidth=n.offsetWidth,i.sHeight=n.offsetHeight;var a=e.offset(n);i.sTop=a.top,i.sLeft=a.left,i.sScale=Math.max(i.sWidth/t.innerWidth,i.sHeight/t.innerHeight)}s.style.webkitTransform="translate3d(0,0,0) scale("+i.sScale+")"},o._getScale=function(e,t){var i=e.width/t.width,s=e.height/t.height,n=1;return n=s>=i?e.height/(t.height*i):e.width/(t.width*s)},o._imgTransitionEnd=function(t){var i=t.target;i.classList.remove(e.className("transitioning")),i.removeEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this))},o._loadItem=function(t,i){var s=this.scroller.querySelector(e.classSelector(".slider-item:nth-child("+(t+1)+")")),n=this.currentGroup[t],a=s.querySelector("img");if(this._initImgData(n,a),i){var r=this._getPosition(n);a.style.webkitTransitionDuration="0ms",a.style.webkitTransform="translate3d("+r.x+"px,"+r.y+"px,0) scale("+n.sScale+")",a.offsetHeight}if(!n.loaded&&a.getAttribute("data-preview-lazyload")){var o=this;o.loader.classList.add(e.className("active")),a.style.webkitTransitionDuration="0.5s",a.addEventListener("webkitTransitionEnd",o._imgTransitionEnd.bind(o)),a.style.webkitTransform="translate3d(0,0,0) scale("+n.sScale+")",this.loadImage(a,function(){n.loaded=!0,a.src=n.lazyload,o._initZoom(s,this.width,this.height),a.classList.add(e.className("transitioning")),a.addEventListener("webkitTransitionEnd",o._imgTransitionEnd.bind(o)),a.setAttribute("style",""),a.offsetHeight,o.loader.classList.remove(e.className("active"))})}else n.lazyload&&(a.src=n.lazyload),this._initZoom(s,a.width,a.height),a.classList.add(e.className("transitioning")),a.addEventListener("webkitTransitionEnd",this._imgTransitionEnd.bind(this)),a.setAttribute("style",""),a.offsetHeight;this._preloadItem(t+1),this._preloadItem(t-1)},o._preloadItem=function(t){var i=this.scroller.querySelector(e.classSelector(".slider-item:nth-child("+(t+1)+")"));if(i){var s=this.currentGroup[t];if(!s.sWidth){var n=i.querySelector("img");this._initImgData(s,n)}}},o._initZoom=function(t,i,s){if(this.options.zoom&&!t.getAttribute("data-zoomer")){var n=t.querySelector(e.classSelector(".zoom"));if("IMG"===n.tagName){var a=this,r=a._getScale({width:t.offsetWidth,height:t.offsetHeight},{width:i,height:s});e(t).zoom({maxZoom:Math.max(r,1)})}else e(t).zoom()}},o.loadImage=function(e,t){var i=function(){t&&t.call(this)},s=new Image;s.onload=i,s.onerror=i,s.src=e.getAttribute("data-preview-lazyload")},o.getRangeByIndex=function(e,t){return{from:0,to:t-1}},o._getPosition=function(e){var i=e.sLeft-t.pageXOffset,s=e.sTop-t.pageYOffset,n=(t.innerWidth-e.sWidth)/2,a=(t.innerHeight-e.sHeight)/2;return{left:i,top:s,x:i-n,y:s-a}},o.refresh=function(i,n){this.currentGroup=n;for(var a=n.length,r=[],o=this.getRangeByIndex(i,a),l=o.from,d=o.to+1,c=i,m="",h="",u=(t.innerWidth,t.innerHeight,0);d>l;l++,u++){var p=n[l],g="";p.sWidth&&(g="-webkit-transform:translate3d(0,0,0) scale("+p.sScale+");transform:translate3d(0,0,0) scale("+p.sScale+")"),h=s.replace("{{src}}",p.src).replace("{{lazyload}}",p.lazyload).replace("{{style}}",g),l===i?(c=u,m=e.className("active")):m="",r.push(h.replace("{{className}}",m))}this.scroller.innerHTML=r.join(""),this.element.style.display="block",this.element.classList.add(e.className("preview-in")),this.lastIndex=c,this.element.offsetHeight,e(this.element).slider().gotoItem(c,0),this.indicator&&(this.indicator.innerText=c+1+"/"+this.currentGroup.length),this._loadItem(c,!0)},o.openByGroup=function(e,t){e=Math.min(Math.max(0,e),this.groups[t].length-1),this.refresh(e,this.groups[t])},o.open=function(t,i){this.element.classList.contains(e.className("preview-in"))||("number"==typeof t?(i=i||n,this.addImages(i,t),this.openByGroup(t,i)):(i=t.getAttribute("data-preview-group"),i=i||n,this.addImages(i,t),this.openByGroup(this.groups[i].indexOf(t.__mui_img_data),i)))},o.close=function(i,s){this.element.classList.remove(e.className("preview-in")),this.element.classList.add(e.className("preview-out"));var n=this.scroller.querySelector(e.classSelector(".slider-item:nth-child("+(this.lastIndex+1)+")")),a=n.querySelector("img");if(a){a.classList.add(e.className("transitioning"));var r=this.currentGroup[this.lastIndex],o=this._getPosition(r),l=o.left,d=o.top;d>t.innerHeight||l>t.innerWidth||0>d||0>l?(a.style.opacity=0,a.style.webkitTransitionDuration="0.5s",a.style.webkitTransform="scale("+r.sScale+")"):(this.options.zoom&&e(a.parentNode.parentNode).zoom().toggleZoom(0),a.style.webkitTransitionDuration="0.5s",a.style.webkitTransform="translate3d("+o.x+"px,"+o.y+"px,0) scale("+r.sScale+")")}for(var c=this.element.querySelectorAll(e.classSelector(".zoom-wrapper")),m=0,h=c.length;h>m;m++)e(c[m]).zoom().destory()},o.isShown=function(){return this.element.classList.contains(e.className("preview-in"))};var l=null;e.previewImage=function(e){return l||(l=new r(e)),l},e.getPreviewImage=function(){return l}}(mui,window);