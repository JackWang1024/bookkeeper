!function(e,i){e.init({gestureConfig:{tap:!0,doubletap:!0,longtap:!0,swipe:!0,drag:!0,hold:!0,release:!0}});var t="ontouchstart"in i,a=t?"tap":"click",r=t?"tap":"click",n=e.className("image");e.dom=function(t){return e.__create_dom_div__||(e.__create_dom_div__=i.createElement("div")),e.__create_dom_div__.innerHTML=t,e.__create_dom_div__.childNodes};var s=e.ImageViewer=e.Class.extend({init:function(e,i){var a=this;a.options=i||{},a.selector=e||"img",a.options.dbl&&(r=t?"doubletap":"dblclick"),a.findAllImage(),a.createViewer(),a.bindEvent()},createViewer:function(){var t=this;t.viewer=e.dom("<div class='mui-imageviewer'><div class='mui-imageviewer-mask'></div><div class='mui-imageviewer-header'><i class='mui-icon mui-icon-closeempty mui-imageviewer-close'></i><span class='mui-imageviewer-state'></span></div><i class='mui-icon mui-icon-arrowleft  mui-imageviewer-left'></i><i class='mui-icon mui-icon-arrowright mui-imageviewer-right'></i></div>"),t.viewer=t.viewer[0]||t.viewer,t.closeButton=t.viewer.querySelector(".mui-imageviewer-close"),t.state=t.viewer.querySelector(".mui-imageviewer-state"),t.leftButton=t.viewer.querySelector(".mui-imageviewer-left"),t.rightButton=t.viewer.querySelector(".mui-imageviewer-right"),t.mask=t.viewer.querySelector(".mui-imageviewer-mask"),i.body.appendChild(t.viewer)},findAllImage:function(){var i=this;i.images=[].slice.call(e(i.selector))},checkImage:function(e){var i=this;return"IMG"!==e.tagName?!1:i.images.some(function(i){return i==e})},bindEvent:function(){var e=this;i.addEventListener(r,function(i){if(e.viewer){var t=i.target;e.checkImage(t)&&(e.viewer.style.display="block",setTimeout(function(){e.viewer.style.opacity=1},0),e.index=e.images.indexOf(t),e.currentItem=e.createImage(e.index))}},!1),e.closeButton.addEventListener(a,function(i){e.viewer.style.opacity=0,setTimeout(function(){e.viewer.style.display="none",e.disposeImage(!0)},600),i.preventDefault(),i.cancelBubble=!0},!1),e.leftButton.addEventListener(a,function(){e.prev()},!1),e.rightButton.addEventListener(a,function(){e.next()},!1),e.mask.addEventListener("touchmove",function(e){e.preventDefault(),e.cancelBubble=!0},!1),e.viewer.addEventListener("swipeleft",function(i){1==e.scaleValue&&e.next(),i.preventDefault(),i.cancelBubble=!0},!1),e.viewer.addEventListener("swiperight",function(i){1==e.scaleValue&&e.prev(),i.preventDefault(),i.cancelBubble=!0},!1),e.viewer.addEventListener("touchstart",function(i){var t=i.touches;if(2==t.length){var a=t[0],r=t[1],n=a.pageX-r.pageX,s=a.pageY-r.pageY;e.scaleStart=Math.sqrt(n*n+s*s),e.isMultiTouch=!0}else(t.length=1)&&(e.dragStart=t[0])},!1),e.viewer.addEventListener("touchmove",function(i){var t=e.currentItem.querySelector("img"),a=i.changedTouches;if(2==a.length){i.preventDefault(),i.cancelBubble=!0;var r=a[0],n=a[1],s=r.pageX-n.pageX,l=r.pageY-n.pageY;e.scaleEnd=Math.sqrt(s*s+l*l),e._scaleValue=e.scaleValue*(e.scaleEnd/e.scaleStart),t.style.webkitTransform="scale("+e._scaleValue+","+e._scaleValue+") "}else e.isMultiTouch||1!=a.length||1==e.scaleValue||(i.preventDefault(),i.cancelBubble=!0,e.dragEnd=a[0],e._dragX=e.dragX+(e.dragEnd.pageX-e.dragStart.pageX),e._dragY=e.dragY+(e.dragEnd.pageY-e.dragStart.pageY),t.style.marginLeft=e._dragX+"px",t.style.marginTop=e._dragY+"px")},!1),e.viewer.addEventListener("touchend",function(){e.scaleValue=e._scaleValue||e.scaleValue,e._scaleValue=null,e.dragX=e._dragX,e.dragY=e._dragY,e._dragX=null,e._dragY=null;var i=event.touches;e.isMultiTouch=0!=i.length}),e.viewer.addEventListener("doubletap",function(){var i=e.currentItem.querySelector("img");1===e.scaleValue?e.scaleValue=2:e.scaleValue=1,e.dragX=0,e.dragY=0,i.style.marginLeft=e.dragX+"px",i.style.marginTop=e.dragY+"px",i.style.webkitTransform="scale("+e.scaleValue+","+e.scaleValue+") ",e.viewer.__tap_num=0},!1)},next:function(){var e=this;e.mask.style.display="block",e.index++;var i=e.createImage(e.index,"right");setTimeout(function(){e.currentItem.classList.remove("mui-imageviewer-item-center"),e.currentItem.classList.add("mui-imageviewer-item-left"),i.classList.remove("mui-imageviewer-item-right"),i.classList.add("mui-imageviewer-item-center"),e.oldItem=e.currentItem,e.currentItem=i,setTimeout(function(){e.disposeImage(),e.mask.style.display="none"},600)},25)},prev:function(){var e=this;e.mask.style.display="block",e.index--;var i=e.createImage(e.index,"left");setTimeout(function(){e.currentItem.classList.remove("mui-imageviewer-item-center"),e.currentItem.classList.add("mui-imageviewer-item-right"),i.classList.remove("mui-imageviewer-item-left"),i.classList.add("mui-imageviewer-item-center"),e.oldItem=e.currentItem,e.currentItem=i,setTimeout(function(){e.disposeImage(),e.mask.style.display="none"},600)},25)},disposeImage:function(i){var t=".mui-imageviewer-item-left,.mui-imageviewer-item-right";i&&(t+=",.mui-imageviewer-item");var a=e(t);a.each(function(e,i){i.parentNode&&i.parentNode.removeChild&&i.parentNode.removeChild(i,!0)})},createImage:function(i,t){var a=this;t=t||"center",0>i&&(i=a.images.length-1),i>a.images.length-1&&(i=0),a.index=i;var r=e.dom("<div class='mui-imageviewer-item'></div>")[0];return r.appendChild(e.dom('<span><img src="'+a.images[a.index].src+'"/></span>')[0]),r.classList.add("mui-imageviewer-item-"+t),a.viewer.appendChild(r),a.state.innerText=a.index+1+"/"+a.images.length,a.scaleValue=1,a.dragX=0,a.dragY=0,r}});e.imageViewer=function(e,i){return new s(e,i)},e.ready(function(){e.imageViewer("."+n)})}(mui,document);